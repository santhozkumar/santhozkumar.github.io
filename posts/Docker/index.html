<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Docker and Kubernetes" /><meta property="og:locale" content="en" /><meta name="description" content="Docker" /><meta property="og:description" content="Docker" /><link rel="canonical" href="https://santhozkumar.github.io/posts/Docker/" /><meta property="og:url" content="https://santhozkumar.github.io/posts/Docker/" /><meta property="og:site_name" content="Santhosh" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-28T21:31:00+05:30" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Docker and Kubernetes" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-28T21:31:00+05:30","datePublished":"2022-06-28T21:31:00+05:30","description":"Docker","headline":"Docker and Kubernetes","mainEntityOfPage":{"@type":"WebPage","@id":"https://santhozkumar.github.io/posts/Docker/"},"url":"https://santhozkumar.github.io/posts/Docker/"}</script><title>Docker and Kubernetes | Santhosh</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Santhosh"><meta name="application-name" content="Santhosh"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> </a></div><div class="site-title mt-3"> <a href="/">Santhosh</a></div><div class="site-subtitle font-italic">Junior Developer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/santhozkumar" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['santhoshkumardeva25','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Docker and Kubernetes</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Docker and Kubernetes</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1656432060" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 28, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/santhozkumar">Santhosh Kumar Devadoss</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3283 words"> <em>18 min</em> read</span></div></div></div><div class="post-content"><h1 id="docker">Docker</h1><p><code class="language-plaintext highlighter-rouge">Docker --version</code> to know the version of docker installed.</p><ul><li>Layers of images<li>Mostly Linux Base image, because small in size e.g. Alpine<li>Application image on top</ul><h3 id="docker-ecosystem"><span class="mr-2">Docker Ecosystem</span><a href="#docker-ecosystem" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Docker server — where docker is installed<li>Docker Client — Cli<li>Docker Daemon — Docker Service<li>Docker machine — is a tool to create small VM’s on Dcoker<li>Docker compose - too to create service, stack of services<li>Swarm — Orchestration tool by Docker. Alternatives Kubernetes or Apache Mesos<li>Registry — where docker images are available</ul><p><strong>Cloud:</strong></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>compute  — underline hardware we can run applications
</pre></table></code></div></div><p>AWS: EC2, lambda, Elastic beanstalk, EKS,</p><p>GCP: compute-engine, cloud-function App-engine, GKS</p><h3 id="container-"><span class="mr-2">Container :</span><a href="#container-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>A way to package application with all the necessary dependecies and configuration</p><p>Containers live in?</p><ul><li>container Repository<li>private repositories<li>public repository for Docker — DockerHub</ul><h3 id="before-containers"><span class="mr-2">Before containers</span><a href="#before-containers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>configuration on the sever needed<li>dependency version conflicts<li>textual guide of deployment<li>misunderstandings</ul><h3 id="aftr-containers"><span class="mr-2">Aftr Containers</span><a href="#aftr-containers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Developers and opeartions work together to package the applccation in a container<li>no environmental configuration needed on the server</ul><h3 id="difference-between-docker-and-vm"><span class="mr-2">Difference between Docker and VM</span><a href="#difference-between-docker-and-vm" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Docker virtualizes the applicaiton layer and uses the kernel of the host, while VM virtualizes the OS kernel and Applications</p><p>Docker toolbox allows you to run the docker images of windows on linux and viceversa</p><h3 id="docker-image-"><span class="mr-2">Docker Image :</span><a href="#docker-image-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Image is a template for creating a environment of our choice. often a snapshot. it contains everything an app needs to run.</p><p>remove all the dangling images (<none>) `docker rmi $(docker images -f "dangling=true" -q)`</none></p><h3 id="container--1"><span class="mr-2">Container :</span><a href="#container--1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Running an instance of an image</p><h3 id="docker-hub-"><span class="mr-2">Docker Hub :</span><a href="#docker-hub-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>It is simply a registry, where you can download images and push your own images for others to use it.</p><p><code class="language-plaintext highlighter-rouge">docker pull image-name : tag-name</code> to pull an image from the dockerhub</p><p><code class="language-plaintext highlighter-rouge">docker image rm image-id</code> to delete the pulled images or <code class="language-plaintext highlighter-rouge">docker rmi image-id</code></p><p><code class="language-plaintext highlighter-rouge">docker image ls</code> to check the images downloaded locally.</p><p><code class="language-plaintext highlighter-rouge">docker run image-name : tag-name</code> to run the container of an image inside docker. it will hang so need to run in detach mode. <code class="language-plaintext highlighter-rouge">docker run -d image-name : tag-name</code></p><p><code class="language-plaintext highlighter-rouge">docker container ls</code> or <code class="language-plaintext highlighter-rouge">docker ps</code> to check the containers running in the docker.</p><p><code class="language-plaintext highlighter-rouge">docker stop container-id</code> or to stop the container running.</p><h2 id="exposing-port"><span class="mr-2">Exposing Port:</span><a href="#exposing-port" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Mapping the <a href="http://localhost">localhost</a> port 8080 to the Container port 80</p><p><code class="language-plaintext highlighter-rouge">docker run -d -p 8080:80 nginx:latest</code></p><p><code class="language-plaintext highlighter-rouge">docker run -d -p 8080:80 -p 3000:80 nginx:latest</code> Mapping multiple ports of local host to the docker container.</p><h2 id="managing-containers"><span class="mr-2">Managing Containers:</span><a href="#managing-containers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Whenever we run the <code class="language-plaintext highlighter-rouge">Docker run</code> command a new container id and name is created. So it is advisable not to use the docker run command once the first container is created.</p><p>use the <code class="language-plaintext highlighter-rouge">docker start</code> and <code class="language-plaintext highlighter-rouge">docker stop</code> commands to start and stop the existing conatainers</p><p><code class="language-plaintext highlighter-rouge">docker ps -a</code> to list all the containers which have been created.</p><p><code class="language-plaintext highlighter-rouge">docker rm container-id</code> or <code class="language-plaintext highlighter-rouge">docker rm container-name</code> to delete the created containers</p><p><code class="language-plaintext highlighter-rouge">docker rm $(docker ps -aq)</code> to remove all the containers which have been created. but won’t remove the running container. use force rm to remove the running also <code class="language-plaintext highlighter-rouge">docker rm -f $(docker ps -aq)</code></p><p><code class="language-plaintext highlighter-rouge">docker run —name website -d -p 8080:80 -p 3000:80 nginx:latest</code> to name the container user the <code class="language-plaintext highlighter-rouge">--name</code> options</p><h2 id="docker-ps-format"><span class="mr-2">Docker PS –Format:</span><a href="#docker-ps-format" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="go"> docker ps —format="ID\\t{{.ID}}\nName\\t{{.Names}}\nImage\\t{{.Image}}\nPorts\\t{{.Ports}}\nCommand\\t{{.Command}}\nCreated\\t{{.CreatedAt}}\nStatus\\t{{.Status}}\n” 
</span></pre></table></code></div></div><p>or set FORMAT=’string’. then access the FORMAT env variable in the command</p><h2 id="volumes"><span class="mr-2">Volumes</span><a href="#volumes" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>For every docker, new volume will be created if not specified. and Stored under <code class="language-plaintext highlighter-rouge">/var/lib/docker/volume</code>. To get more storage, mount this directory to the Storage capacity and use the created volumes</p><p><code class="language-plaintext highlighter-rouge">docker volume create volume-name</code></p><p>allows sharing of data. Files and Folders.</p><p>Between host and container. Between containers</p><p><code class="language-plaintext highlighter-rouge">docker run --name website -v source:destination:ro -d -p 8080:80 image-name</code></p><p><code class="language-plaintext highlighter-rouge">docker run --name website -v $(pwd):/usr/share/nginx/html:ro -d -p 8080:80 nginx</code></p><p><img data-src="Docker%20and%20Kubernetes%20e856bd0eb3074698a7c7fbeaf0c2d051/Untitled.png" alt="Docker%20and%20Kubernetes%20e856bd0eb3074698a7c7fbeaf0c2d051/Untitled.png" data-proofer-ignore></p><p>Three types :</p><ul><li>Mount with the path from the host file system<li>Anonymous volumes<li>Named volumes</ul><p>Mounted volumes are stored in /var/lib/docker/volumes</p><h3 id="volumes-between-host-and-container"><span class="mr-2">Volumes between host and container</span><a href="#volumes-between-host-and-container" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">docker exec -it website bash</code> to open the container in the interactive mode and start with bash terminal</p><h3 id="volumesbetween-containers"><span class="mr-2">Volumes(Between Containers)</span><a href="#volumesbetween-containers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">docker run --volumes-from website --name website-copy -d -p 8081:80 nginx</code></p><h2 id="dockerfile"><span class="mr-2">DockerFile</span><a href="#dockerfile" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><p>Build own images, it contains list of steps of how to create our image</p><p>Docker can build images automatically by reading the instructions from a Dockerfile. A Dockerfile is a text document that contains all the commands a user could call on the command line to assemble an image. Using docker build users can create an automated build that executes several command-line instructions in succession.</p></ul><p><code class="language-plaintext highlighter-rouge">FROM nginx:latest</code></p><p><code class="language-plaintext highlighter-rouge">ADD . /usr/share/nginx/html</code></p><h3 id="iac---infrastructure-as-code"><span class="mr-2">IAC - Infrastructure as Code</span><a href="#iac---infrastructure-as-code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Ansible<li>Teraform<li>Powershell<li>Chef<li>Puppet<li>Jenkins Pile Scripting</ul><h2 id="docker-build"><span class="mr-2">Docker Build</span><a href="#docker-build" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Dockerfile is used to create custom image</p><p><code class="language-plaintext highlighter-rouge">docker build --tag website:latest .</code> —&gt; this command looks for the dockerfile in the current directory and build the image</p><p><a href="https://docs.docker.com/reference">Reference documentation</a></p><p>FROM -</p><p>ADD - to add file in the working directory</p><p>RUN -</p><p>CMD - to copy file from base machine to container</p><p>WORKDIR - set the working directory for the container, if not exists, it will create new one</p><p><strong>Python implementation of Docker file</strong></p><p>FROM python:latest</p><p>WORKDIR /app</p><p>COPY . /app</p><p>RUN pip install —trusted-host <a href="http://pypi.python.org">pypi.python.org</a> -4 requirements.txt</p><p>EXPOSE 80</p><p>ENV NAME World</p><p>CMD [“python”, “app.py”]</p><h2 id="dockerignore"><span class="mr-2">.dockerignore</span><a href="#dockerignore" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>node_modules</p><p>Dockerfile</p><p>.git</p><p>*.gulp.js</p><p>folder/*.exe</p><h2 id="caching-and-layers"><span class="mr-2">Caching and Layers</span><a href="#caching-and-layers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Every step in dockerfile is a layer, layer can be used to caching</p><h2 id="alpine--linux-edition"><span class="mr-2">Alpine — linux edition</span><a href="#alpine--linux-edition" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>can be used to reduce the sizze of the image</p><h3 id="pulling-alpine-images"><span class="mr-2">Pulling alpine images</span><a href="#pulling-alpine-images" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">Docker pull image-name:tag-name</code></p><h3 id="tags-versionsing"><span class="mr-2">Tags, Versionsing</span><a href="#tags-versionsing" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">docker build -t santhosh-website:latest .</code></p><p><code class="language-plaintext highlighter-rouge">docker tag santhosh-website:latest santhosh-website:1</code></p><p>After tag command image id will be same.</p><h3 id="docker-registry"><span class="mr-2">Docker Registry</span><a href="#docker-registry" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Highly scalable server side application that stores and lets you distribute Docker images</p><p>Used in CD/CI pipeline</p><p>Run your applications</p><p>Private/Public Registries available.</p><ul><li>Docker Hub<li>quay.io<li>Amazon ECR</ul><h3 id="pushing-images-to-docker-hub"><span class="mr-2">pushing images to docker hub</span><a href="#pushing-images-to-docker-hub" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>You can push a new image to this repository using the CLI</p><p><code class="language-plaintext highlighter-rouge">docker tag local-image:tagname new-repo:tagname</code></p><p><code class="language-plaintext highlighter-rouge">docker push new-repo:tagname</code></p><h3 id="pulling-own-images"><span class="mr-2">Pulling own images</span><a href="#pulling-own-images" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">docker pull santozkumar/website:latest</code></p><h3 id="inspect-command"><span class="mr-2">Inspect command</span><a href="#inspect-command" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">docker inspect image-id</code> or <code class="language-plaintext highlighter-rouge">docker inspect container-id</code></p><h3 id="docker-logs"><span class="mr-2">Docker Logs</span><a href="#docker-logs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">docker logs container-id</code></p><p><code class="language-plaintext highlighter-rouge">docker logs -f container-id</code></p><h3 id="docker-exec"><span class="mr-2">Docker EXec</span><a href="#docker-exec" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><code class="language-plaintext highlighter-rouge">docker exec -it container-id /bin/bash</code></p><h2 id="docker-network"><span class="mr-2">Docker Network</span><a href="#docker-network" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="table-wrapper"><table><tbody><tr><td>ifconfig -a<td>more</table></div><p>below docker0 supplies the ip-address to all the containers in the netwok</p><p>docker0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500 inet 172.17.0.1 netmask 255.255.0.0 broadcast 172.17.255.255 inet6 fe80::42:48ff:feb2:c741 prefixlen 64 scopeid 0x20<link /> ether 02:42:48:b2:c7:41 txqueuelen 0 (Ethernet) RX packets 17 bytes 5206 (5.2 KB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 51 bytes 7535 (7.5 KB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0</p><p><code class="language-plaintext highlighter-rouge">docker network ls</code> to check the list of docker netword created</p><p><code class="language-plaintext highlighter-rouge">docker network create new-network-name</code> to create a new docker netword</p><p><code class="language-plaintext highlighter-rouge">docker network inspect new-network-name</code> to inspect the subnet of the created network</p><p><code class="language-plaintext highlighter-rouge">docker network disconnect network-name container-name</code> to disconnect</p><p><code class="language-plaintext highlighter-rouge">docker network connect network-name container-name</code> to connect</p><p><code class="language-plaintext highlighter-rouge">docker network rm network-name</code> to delete the created network</p><p><code class="language-plaintext highlighter-rouge">docker network prune</code> remove all unused networks</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>docker run -d --network some-network --name some-mongo \
    -e MONGO_INITDB_ROOT_USERNAME=mongoadmin \
    -e MONGO_INITDB_ROOT_PASSWORD=secret \
    mongo
</pre></table></code></div></div><h2 id="docker-compose"><span class="mr-2">Docker Compose</span><a href="#docker-compose" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Compose is a tool for defining and running multi-container Docker applications. With Compose, you use a <strong>YAML</strong> file to configure your application’s services. Then, with a single command, you create and start all the services from your configuration.</p><p><code class="language-plaintext highlighter-rouge">Docker-compose up</code></p><h2 id="docker-swarm"><span class="mr-2">Docker Swarm</span><a href="#docker-swarm" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><strong>Hardware requirements</strong></p><ol><li>manager/master node<li>worker nodes(atleast 2)</ol><p><strong>Software requirments</strong></p><ol><li>in all machine docker must run ( systemctl status docker)<li>all machines are interconnected<ol><li>(ip a) to check ip address of all machines<li>cat /etc/hosts add other hosts ip in this file with names<li>ping -c 3 docker-master</ol><li>all the machines are ssh enabled</ol><p><code class="language-plaintext highlighter-rouge">docker node ls</code> to check the nodes connected in the docker-swarm cluster (i.e. status of cluster)</p><p><code class="language-plaintext highlighter-rouge">docker swarm leave</code> to leave from the cluster</p><p><code class="language-plaintext highlighter-rouge">docker swarm init --advertise-addr ip-address-value</code> to initialize the cluster, this node will be assigned as manager. and it shows the command to add the worker and other manager node to this cluster</p><p>Deplying a service into the swarm cluster.<code class="language-plaintext highlighter-rouge">docker service create —replicas 7 -p 80:80 nginx</code></p><p>above command creates 7 containers of nginx in the cluster.</p><p><code class="language-plaintext highlighter-rouge">docker stack deploy -c docker-compose.yaml myapp-stach</code></p><p><code class="language-plaintext highlighter-rouge">docker node inspect self</code> to check the ip-address and name and configs of the host</p><p><code class="language-plaintext highlighter-rouge">docker node inspect docker-worker1</code> configs of other host in cluster</p><p><code class="language-plaintext highlighter-rouge">docker node update —availability drain docker-worker1</code></p><h1 id="kubernetes">Kubernetes</h1><ul><li>Provisioning and deployment of containers<li>Redundancy and availability of containers<li>Scaling up or removing containers to spread application load evenly actoss<li>Movement of containers from one host to another if there is a shortage<li>Allocation of resources between containers<li>External exposure of services running in a container with the outside world<li>Load balancing of service discovery b/w containers<li>Health monitoring and logs</ul><p><strong>In Docker Swarm containers split including master nodes, but in kubernetes master node doesn’t run any app containers, it run maximun no of internal processes</strong></p><p>Kubernetes is the most popular container orchestration tool</p><p><strong>Official definition :</strong></p><p>open source container orchestration tool, developed by google.</p><p>helps you <strong>manage containerized applications</strong> in different <strong>deployment environments</strong> (physical, virtual and hybrid)</p><p><strong>what problem does Kubernetes solve?</strong></p><p>increasing usage of Microservices and able to solve the increased usage of containers</p><p><strong>what features do orchestration tool offer?</strong></p><p>High availability or no downtime</p><p>Scalability or high performance</p><p>Disaster recovery - backup and restore</p><h2 id="kubernetes-architecture"><span class="mr-2">Kubernetes Architecture</span><a href="#kubernetes-architecture" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><strong>Cluster</strong></p><ul><li><p>group of application instances - SWARM, Kubernetes, Apache mesos</p><li><p>group of database instances - RAC</p><li><p>group of servers - SUN, Veritas, Redhat Cluster, IBM cluster</p></ul><p><strong>Advantages of cluster :</strong></p><ul><li>High availaility<li>auto-scaling<li>auto-healing<li>load-balancing</ul><p>Master node will be connected to the couple of worker nodes, where each worker node has the <strong>Kubelet</strong> process running it.</p><p>Kubelet is a kubernetes process that makes it possible for the cluster to talk to each other and execute some tasks on nodes.</p><p>On worker Nodes our applications are running. Much bigger more resources.</p><p>On Master Nodes, important K8s processes are running. more important. so have the backup of master in prod environments.</p><p><strong>Kubernetes master:</strong> the master manages the scheduling and deployment of application instances across nodes, and the full set of services the master node runs is know as the control plane. The master communicates with nodes through the <strong>kubernetes API server.</strong> The scheduler assigns nodes to pods depending on the resource and policy constraints you’ve defined.</p><p><strong>Kubelet :</strong> Each node runs an agent process called a kubelet, that’s responsible for managing the state of the node: starting, stopping and maintaining application containers based on instructions from control plane. It receives information from the kubernetes API server.</p><ul><li>API Server - which also a contianer, entrypoint to K8S cluster, different kubernetes clients will talk to this via UI, API, or CLI.<li>Controller manager - keeps track of whats happening in the cluster. detects cluster changes i.e. if any pod dies. <strong>Controller Manager —&gt; Scheduler —&gt; where(node) to put pod? —&gt; Kubelet</strong><li>Scheduler - scheduling containers on different nodes based on work load, available server resources. <strong>ensures Pods placement. Schedule new pod —&gt; API Server —&gt; Scheduler —&gt; where to put the pod? —&gt; kubelet starts the pod</strong><li>etcd — basically holds anytime the current state of the cluster. holds all the configuration data, state data of each container on each node. Backup and restore is made from this etcd snapshots kubernetes backing key-value store. What resources are available? Did the cluster state change? is the cluster healthy? all these informations are stored in etcd.</ul><p><strong>Virtual Network</strong> which enables master and work nodes to talk to each other. Creates on unified machine.</p><ul><li>each node has multiple Pods on it<li>3 processes must be installed on every Node, that are used to schedule and manage those pods<ul><li>Container runtime — like Docker or something<li>Kubelet interacts with both - the container and node. it schedules the process. it <strong>starts the pod</strong> with a container inside<li>Kube Proxy - forwarding requests from services to Pods.</ul><p><a href="https://notes.shichao.io/unp/ch2/">Chapter 2. The Transport Layer: TCP, UDP, and SCTP - Shichao’s Notes</a></p><p>Services — communication between the Pods is handled</p></ul><p>How do you <strong>interact</strong> with this cluster?</p><h3 id="kubectl-setup-"><span class="mr-2">Kubectl setup :</span><a href="#kubectl-setup-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">echo</span> <span class="s2">"source &lt;(kubectl completion bash)"</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="nb">source</span> .bashrc
</pre></table></code></div></div><p><a href="https://wiprocon.webex.com/wiprocon/url.php?frompanel=false&amp;gourl=https://kubernetes.io/docs/concepts/services-networking/connect-applications-service">https://kubernetes.io/docs/concepts/services-networking/connect-applications-service</a>/10:18</p><p>kubernetes.io/docs/tutorials/stateless-application/guestbook10:19</p><p><a href="https://wiprocon.webex.com/wiprocon/url.php?frompanel=false&amp;gourl=https://labs.play-with-k8s.com">https://labs.play-with-k8s.com</a>/10</p><h2 id="job"><span class="mr-2">Job</span><a href="#job" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>A Job creates one or more Pods and ensures that a specified number of them successfully terminate. As pods successfully complete, the Job tracks the successful completions. When a specified number of successful completions is reached, the task (ie, Job) is complete. Deleting a Job will clean up the Pods it created.</p><h3 id="pod-services-and-ingress"><span class="mr-2">Pod, Services and Ingress</span><a href="#pod-services-and-ingress" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>Node —</strong> physical or virtual server</p><p>Pod —</p><ul><li>smallest unit of K8s<li>Abstraction over container<li>usually 1 application per Pod<li>Each Pod gets it’s own IP address<li>New IP address on re-creation — it;s a disadvantage when Pod is dead, new ip created. So <strong>service</strong> helps to overcome this</ul><p>Service :</p><ul><li>Permanent IP address attached to each Pod<li>Also acts as a load balancer<li>lifecycle of Pod and Service not connected. even pod dies, ip address stay.</ul><p>Ingress :</p><p>request first goes to ingress, it does the forward invent to the service.</p><p>allows to name the website.</p><ul><li><p>image</p><p><img data-src="Docker%20and%20Kubernetes%20e856bd0eb3074698a7c7fbeaf0c2d051/Untitled%201.png" alt="Docker%20and%20Kubernetes%20e856bd0eb3074698a7c7fbeaf0c2d051/Untitled%201.png" data-proofer-ignore></p></ul><h3 id="config-map-and-secret"><span class="mr-2">Config Map and Secret</span><a href="#config-map-and-secret" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>ConfigMap : external configuration of your application <code class="language-plaintext highlighter-rouge">DB_URL = mongo-db</code></p><p>Secret : used to store secret data, stored in base64 encoded. <code class="language-plaintext highlighter-rouge">DB_USER = mongo-user</code> <code class="language-plaintext highlighter-rouge">or</code> <code class="language-plaintext highlighter-rouge">DB_PASSWORD = mongo-password</code></p><p>Use the above as environment variables or as a properties file.</p><h3 id="volumes-1"><span class="mr-2">Volumes:</span><a href="#volumes-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>if the DB restarted, data is gone. so attach a local or remote storage volume to the DB Pod.</p><p>K8S doesn’t manage data persistance, our responsible to backup or replicate the data in external hardware</p><h3 id="deployment-and-stateful-set"><span class="mr-2">Deployment and Stateful Set</span><a href="#deployment-and-stateful-set" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Replicate Everything on multiple nodes</p><p><strong>Deployment :</strong></p><p>Replica is connected to the same Service(permanent Ip, load balancer)</p><p>define blueprints for my-app pods —&gt; which is called as deployments</p><p>deployment is the abstraction of pods.</p><p>DB can’t be replicated via Deployment. because DB have state, so use Statefulset to avoid data inconsistencies.</p><p><strong>StatefulSET :</strong></p><p>for StateFull apps or Databases. which read and writes are synchronized.</p><p>Deploying Statefulset not easy, so often host DB outside of K8s cluster and do deployents of Stateless applications.</p><h3 id="benefits-of-k8s"><span class="mr-2">Benefits of K8s.</span><a href="#benefits-of-k8s" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><p>High availability and scalability</p><p>Every component is <strong>replicated, load balanced, no bottleneck</strong> that slows down the responses</p><li></ul><h3 id="components-summary"><span class="mr-2">Components summary:</span><a href="#components-summary" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>POD - abstraction of containers</p><p>Service - Communication</p><p>Ingress - route traffic into cluster</p><p>ConfigMap and Secrets - External Configuration</p><p>Volumes - Data persistance</p><p>Deployment and StatefulSet — Replicating mechanisms</p><h2 id="minikube-and-kubectl"><span class="mr-2">Minikube and Kubectl</span><a href="#minikube-and-kubectl" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>kubeadm is utility to create multi-node cluster</p><p>minikube is utility to create single-node cluster</p><p>kubectl is a cli/utility to communicate with k8s cluster</p><ul><li><p>Structure</p><p><img data-src="Docker%20and%20Kubernetes%20e856bd0eb3074698a7c7fbeaf0c2d051/Untitled%202.png" alt="Docker%20and%20Kubernetes%20e856bd0eb3074698a7c7fbeaf0c2d051/Untitled%202.png" data-proofer-ignore></p></ul><p><strong>What is Minikube?</strong></p><p>Test/Local cluster setup</p><p>creates virtual box on your laptop</p><p>Node runs in that Virtual Box</p><p>1 Node k8s cluster</p><p>for testing purposes</p><p><strong>what is Kubectl?</strong></p><p>command line tool for any type for k8s cluster</p><p><strong>Minikube master :</strong></p><ul><li>kube-apiserver<li>Etcd<li>Node-Controller<li>Replica-controller</ul><p><strong>Worker node</strong></p><ul><li>Kubelet<li>Container runtime<li>kube-proxy</ul><p><strong>Kube</strong></p><p><code class="language-plaintext highlighter-rouge">minikube start —vm-driver=hyperkit</code> to start the kubernetes cluster</p><p><code class="language-plaintext highlighter-rouge">kubectl get nodes</code> or <code class="language-plaintext highlighter-rouge">kubectl get nodes -o wide</code>get the status of the nodes of the k8s cluster</p><p><code class="language-plaintext highlighter-rouge">minikube status</code></p><p><code class="language-plaintext highlighter-rouge">kubectl version</code> to find the version of kubernetes</p><p>Minikube CLI … for start up/deleting the cluster</p><p>Kebectl CLI …for configuring the Minikube cluster</p><h2 id="create-deployment"><span class="mr-2">Create Deployment</span><a href="#create-deployment" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li></ul><p><code class="language-plaintext highlighter-rouge">kubectl get all</code> to get all the components running inside the cluster</p><p><strong><code class="language-plaintext highlighter-rouge">kubectl get nodes</code></strong></p><p><code class="language-plaintext highlighter-rouge">kubectl get pod</code></p><p><code class="language-plaintext highlighter-rouge">kubectl get services</code></p><p><code class="language-plaintext highlighter-rouge">kubectl create deployment NAME —image=image [—dry-run] [options]</code></p><p>e.g. <code class="language-plaintext highlighter-rouge">kubectl create deployment nginx-depl —image=nginx</code></p><p><code class="language-plaintext highlighter-rouge">kubectl get deployment</code></p><p><code class="language-plaintext highlighter-rouge">kubectl get pod</code></p><p><code class="language-plaintext highlighter-rouge">kubectl delete deployment</code> to delete the deployment along with pods and replicaset related to the deployment</p><h2 id="debugging-pods"><span class="mr-2">Debugging Pods</span><a href="#debugging-pods" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><code class="language-plaintext highlighter-rouge">kubectl logs pod-name</code></p><p><code class="language-plaintext highlighter-rouge">kubectl describe pod pod-name</code></p><p><code class="language-plaintext highlighter-rouge">kubectl exec -it pod-name — bin/bash</code> entr the container and look at the terminal</p><h3 id="kubectl-apply--f"><span class="mr-2">Kubectl apply -F</span><a href="#kubectl-apply--f" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>instead of create deployment with using command line, we can use the configuration files</p><p><code class="language-plaintext highlighter-rouge">kubectly apply -f config-file.yaml</code> if deployment already created/ it updates with the new configs</p><p><code class="language-plaintext highlighter-rouge">kubectl delete -f config-file.yaml</code> to delete the deployment</p><p><a href="https://www.notion.so/Why-Yaml-083e6e3004ac447c9bb55a3aeae71645">Why Yaml</a></p><h3 id="yaml-configuration-file-explained"><span class="mr-2">Yaml Configuration file explained</span><a href="#yaml-configuration-file-explained" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Each configuratioin file has 3 parts</p><ol><li>Metadata<li>Specs —&gt; attributes are specific to the type of components<li>Status —&gt; automatically generated and added by kubernetes</ol><p>First two lines will be what component we want to create</p><h2 id="apiversion-field"><span class="mr-2">apiVersion field</span><a href="#apiversion-field" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>kind Version</p><p>pod v1</p><p>service v1</p><p>Replicaset apps/v1</p><p>Deployment apps/v1</p><p>Kind —- refers to the type of different objects, it may be pod, ReplicaSet, ReplicationController, Deployment</p><p>metadata — the data about the object. useful when we have a lot of pods, and we can use these to substitue ports for those objects</p><p>spec —- Additional information of the object</p><h3 id="kubectl-service"><span class="mr-2">Kubectl service:</span><a href="#kubectl-service" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li></ul><p><code class="language-plaintext highlighter-rouge">kubectl apply -f nginx-service.yaml</code> — to create Service using config file</p><p><code class="language-plaintext highlighter-rouge">kubectl describe service nginx-service</code> — to get thee information of port, target port and and pods ip which it will forward the requests</p><p><code class="language-plaintext highlighter-rouge">kubectl get pod -o wide</code> to check the ip addresses of the pod. shows more info</p><p><code class="language-plaintext highlighter-rouge">kubectl get deployment nginx-deployment -o yaml &gt; nginx-deployment.yaml</code> to get the current deployment configs in the yaml file, could be used to copy and do other deployments, but needs to be cleaned some of the unique attributes</p><p>To get the base 64 encoded strings like username and password to use in the secret</p><p><code class="language-plaintext highlighter-rouge">echo -n 'someSecretString' | base64</code></p><p>Order of creation of components in the Kubernetes matter.</p><ol><li>Create Secrets or configmaps if defined<li>Create deployment</ol><h3 id="types-of-service"><span class="mr-2">Types of Service</span><a href="#types-of-service" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li>Internal Service or Cluster IP is Default<li>Load Balance is for External communication service. needs to be defined in servic config file as type</ul><p><strong>Templates</strong></p><ul><li><p>MongoDB and internal service and secrets</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre><td class="rouge-code"><pre>  <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">mongodb-deployment</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">mongodb</span>
  <span class="na">spec</span><span class="pi">:</span>
    <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
    <span class="na">selector</span><span class="pi">:</span>
      <span class="na">matchLabels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">mongodb</span>
    <span class="na">template</span><span class="pi">:</span>
      <span class="na">metadata</span><span class="pi">:</span>
        <span class="na">labels</span><span class="pi">:</span>
          <span class="na">app</span><span class="pi">:</span> <span class="s">mongodb</span>
      <span class="na">spec</span><span class="pi">:</span>
        <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mongodb</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">mongo</span>
          <span class="na">ports</span><span class="pi">:</span> 
          <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">27017</span>
          <span class="na">env</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">MONGO_INITDB_ROOT_USERNAME</span>
            <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">secretKeyRef</span><span class="pi">:</span>
                  <span class="na">name</span><span class="pi">:</span> <span class="s">mongodb-secret</span>
                  <span class="na">key</span><span class="pi">:</span> <span class="s">mongo-root-username</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">MONGO_INITDB_ROOT_PASSWORD</span>
            <span class="na">valueFrom</span><span class="pi">:</span>
                <span class="na">secretKeyRef</span><span class="pi">:</span>
                  <span class="na">name</span><span class="pi">:</span> <span class="s">mongodb-secret</span>
                  <span class="na">key</span><span class="pi">:</span> <span class="s">mongo-root-password</span>
  <span class="s">---</span>
  <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">mongodb-service</span>
  <span class="na">spec</span><span class="pi">:</span>
    <span class="na">selector</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">mongodb</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
        <span class="na">port</span><span class="pi">:</span> <span class="m">27017</span>
        <span class="na">targetPort</span><span class="pi">:</span> <span class="m">27017</span>
</pre></table></code></div></div><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>  <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Secret</span>
  <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">mongodb-secret</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">Opaque</span>
  <span class="na">data</span><span class="pi">:</span>
      <span class="na">mongo-root-username</span><span class="pi">:</span> <span class="s">dXNlcm5hbWU=</span>
      <span class="na">mongo-root-password</span><span class="pi">:</span> <span class="s">cGFzc3dvcmQ=</span>
</pre></table></code></div></div><li><p>Mongo express and External service and configmap</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
</pre><td class="rouge-code"><pre>  <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">mongo-express</span>
    <span class="na">labels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">mongo-express</span>
  <span class="na">spec</span><span class="pi">:</span>
    <span class="na">replicas</span><span class="pi">:</span> <span class="m">1</span>
    <span class="na">selector</span><span class="pi">:</span>
      <span class="na">matchLabels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">mongo-express</span>
    <span class="na">template</span><span class="pi">:</span>
      <span class="na">metadata</span><span class="pi">:</span>
        <span class="na">labels</span><span class="pi">:</span>
          <span class="na">app</span><span class="pi">:</span> <span class="s">mongo-express</span>
      <span class="na">spec</span><span class="pi">:</span>
        <span class="na">containers</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">mongo-express</span>
          <span class="na">image</span><span class="pi">:</span> <span class="s">mongo-express</span>
          <span class="na">ports</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8081</span>
          <span class="na">env</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ME_CONFIG_MONGODB_ADMINUSERNAME</span>
            <span class="na">valueFrom</span><span class="pi">:</span>
              <span class="na">secretKeyRef</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">mongodb-secret</span>
                <span class="na">key</span><span class="pi">:</span> <span class="s">mongo-root-username</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ME_CONFIG_MONGODB_ADMINPASSWORD</span>
            <span class="na">valueFrom</span><span class="pi">:</span> 
              <span class="na">secretKeyRef</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">mongodb-secret</span>
                <span class="na">key</span><span class="pi">:</span> <span class="s">mongo-root-password</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ME_CONFIG_MONGODB_SERVER</span>
            <span class="na">valueFrom</span><span class="pi">:</span> 
              <span class="na">configMapKeyRef</span><span class="pi">:</span>
                <span class="na">name</span><span class="pi">:</span> <span class="s">mongodb-configmap</span>
                <span class="na">key</span><span class="pi">:</span> <span class="s">database_url</span>
  <span class="s">---</span>
  <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">Service</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">mongo-express-service</span>
  <span class="na">spec</span><span class="pi">:</span>
    <span class="na">selector</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">mongo-express</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">LoadBalancer</span>  
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">protocol</span><span class="pi">:</span> <span class="s">TCP</span>
        <span class="na">port</span><span class="pi">:</span> <span class="m">8081</span>
        <span class="na">targetPort</span><span class="pi">:</span> <span class="m">8081</span>
        <span class="na">nodePort</span><span class="pi">:</span> <span class="m">30000</span>
</pre></table></code></div></div><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>  <span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
  <span class="na">kind</span><span class="pi">:</span> <span class="s">ConfigMap</span>
  <span class="na">metadata</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">mongodb-configmap</span>
  <span class="na">data</span><span class="pi">:</span>
    <span class="na">database_url</span><span class="pi">:</span> <span class="s">mongodb-service</span>
</pre></table></code></div></div></ul><p>After the external service is created, external ip will be shown in <code class="language-plaintext highlighter-rouge">kubectl get services</code>, in minikube need to run the <code class="language-plaintext highlighter-rouge">kubectl service external-service-name</code> to get the ip.</p><h3 id="namespace"><span class="mr-2">NAMESPACE:</span><a href="#namespace" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><strong>What is a Namespace?</strong></p><p>organise resources in namespace</p><p>virtual cluster inside a kubernetes cluster</p><p><strong>4 names per Default</strong></p><ul><li>kube-system : do not create or modify in kube-system, Sytem process, Master and kubectl processes<li>Kube-public : public acccessible data; A configmap, which contains cluster information</ul><p><strong>Why to use the namespace?</strong></p><h3 id="ingress"><span class="mr-2">Ingress:</span><a href="#ingress" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>to use the ingress, need the ingress controller to evaluate the rules and forward the request.</p><p><code class="language-plaintext highlighter-rouge">minikube addons enable ingress</code></p><h3 id="helm"><span class="mr-2">Helm</span><a href="#helm" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>package manager for kubernetes</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/development/'>Development</a>, <a href='/categories/testing/'>Testing</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/docker/" class="post-tag no-text-decoration" >docker</a> <a href="/tags/kubernetes/" class="post-tag no-text-decoration" >kubernetes</a> <a href="/tags/test/" class="post-tag no-text-decoration" >test</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Docker+and+Kubernetes+-+Santhosh&url=https%3A%2F%2Fsanthozkumar.github.io%2Fposts%2FDocker%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Docker+and+Kubernetes+-+Santhosh&u=https%3A%2F%2Fsanthozkumar.github.io%2Fposts%2FDocker%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fsanthozkumar.github.io%2Fposts%2FDocker%2F&text=Docker+and+Kubernetes+-+Santhosh" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Poetry/">Poetry Commands</a><li><a href="/posts/systemd/">Systemd learning</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/notes/">notes</a> <a class="post-tag" href="/tags/test/">test</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/service/">service</a> <a class="post-tag" href="/tags/ts/">ts</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Testing-Blog/"><div class="card-body"> <em class="small" data-ts="1748543400" data-df="ll" > May 30, 2025 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Testing Blog</h3><div class="text-muted small"><p> inline code part 1 This is a plaintext code snippet. 1 key: value</p></div></div></a></div><div class="card"> <a href="/posts/systemd/"><div class="card-body"> <em class="small" data-ts="1691251260" data-df="ll" > Aug 5, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Systemd learning</h3><div class="text-muted small"><p> What is ‘Systemd’? It’s an init system The init system is the process running on your server(PID 1) It manages all services that run in the background Working with Units Units in System...</p></div></div></a></div><div class="card"> <a href="/posts/TypeScript/"><div class="card-body"> <em class="small" data-ts="1696953660" data-df="ll" > Oct 10, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Docker and Kubernetes</h3><div class="text-muted small"><p> The Basics To install the typescript compiler globally npm install -g typescript Emitting with Errors, even tsc reports errors it still emits js files to stop it run tsc --noEmitOnError hello.ts ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"><div class="btn btn-outline-primary disabled" prompt="Older"><p>-</p></div><a href="/posts/systemd/" class="btn btn-outline-primary" prompt="Newer"><p>Systemd learning</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/santhozkumar">Santhosh Kumar Devadoss</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/notes/">notes</a> <a class="post-tag" href="/tags/test/">test</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/service/">service</a> <a class="post-tag" href="/tags/ts/">ts</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"> </script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
